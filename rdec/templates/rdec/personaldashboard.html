{% extends 'rdec/root.html' %}
{% block body %}
<h1>Roller Derby Event Coordinator</h1>
    <h2>Upcoming Events for {{ user.first_name }}</h2>


    <div class="table-responsive">
            <table class="table table-hover table-condensed">
        <thead>
        <tr>
            <th>Event</th>
            <th>Date</th>
            <th>Location</th>
            <th>Attending As</th>
        </tr>
        </thead>
        <tbody>
    {% for event, response in events.items %}
        <tr>
        <td>{{ event.name }}</td>
        <td>{{ event.date|date:"D d F Y, f a" }}</td>
        <td>{{ event.location }}</td>
        <td>
            <select title='Attending' id="{{ event.id }}" class='attending_changer'>
            <option value="null">N/A</option>
            {% for role in roles %}
                <option value="{{ role.id }}" {% if role.id == response.role_id %}selected{% endif %}>{{ role }}</option>
            {% endfor %}
            </select>
        </td>
        </tr>
    {% endfor %}

        </tbody>
    </table>
    </div>




{% endblock %}

{% block script %}
    <script>
    $(".attending_changer").change(function() {
       var new_value = $(this).val();
        var payload = {
            'event_id': $(this).attr('id'),
            'new_status': new_value,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        };
        $.ajax('{% url 'change_attending' %}', {
            method: 'POST',
            data: payload
        }).done(function(data) {

        }).fail(function() {
            alert('nope');
        });
    });
    </script>
{% endblock %}
